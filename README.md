# üöÄ Alembic + SQLAlchemy (async) + PostgreSQL

## –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–±–æ—Ç–µ —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
–î–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Alembic** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ —Å–≤—è–∑–∫–µ —Å
**SQLAlchemy (async) –∏ PostgreSQL.**

–î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Alembic, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ, —Å–æ–∑–¥–∞–Ω–∏—è –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π, –∞ —Ç–∞–∫–∂–µ –≤–∞–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã —Ä–∞–±–æ—Ç—ã —Å ENUM –∏ ForeignKey.

## üöÄ –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
- Python 3.13
- PostgreSQL
- SQLAlchemy 2.0+ (async)
- Alembic
- asyncpg

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
`pip install sqlalchemy alembic asyncpg psycopg`

## ‚öôÔ∏è –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Alembic (async)
–í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

`alembic init -t async migration`

–ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è **migration/** —Å —à–∞–±–ª–æ–Ω–∞–º–∏ –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã SQLAlchemy.

## üß± –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
–ü–æ—Å–ª–µ –æ–ø–∏—Å–∞–Ω–∏—è –º–æ–¥–µ–ª–µ–π:

`alembic revision --autogenerate -m "Initial revision"`

Alembic —Å–æ–∑–¥–∞—Å—Ç —Ñ–∞–π–ª –≤ **migration/versions/**

## üöÄ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
`alembic upgrade head`

## ‚è™ –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π
–û—Ç–∫–∞—Ç –Ω–∞ –æ–¥–Ω—É –≤–µ—Ä—Å–∏—é –Ω–∞–∑–∞–¥:

`alembic downgrade -1`

–û—Ç–∫–∞—Ç –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏:

`alembic downgrade <revision_id>`

# ‚ö†Ô∏è –í–ê–ñ–ù–û: –†–∞–±–æ—Ç–∞ —Å ENUM
## ‚úÖ –í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞—Ç—å create_type=False

```python
sa.Column(
    "status",
    sa.Enum("active", "inactive", name="user_status",create_type=False), nullable=False
)
```

–ë–µ–∑ —ç—Ç–æ–≥–æ Alembic –º–æ–∂–µ—Ç –ø–∞–¥–∞—Ç—å –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏—è—Ö. 

## üßπ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ ENUM –ø—Ä–∏ downgrade
–í `downgrade()`:

```python
def downgrade():
    op.drop_table("users")
    op.execute("DROP TYPE IF EXISTS user_status")
```